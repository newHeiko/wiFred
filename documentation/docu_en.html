<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.15">
<meta name="description" content="Usage documentation, server choices, building instructions, schematics, part lists...">
<meta name="author" content="Heiko Rosemann">
<title>wiFred: WiFi throttle for model railroads using the wiThrottle protocol</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article">
<div id="header">
<h1>wiFred: WiFi throttle for model railroads using the wiThrottle protocol</h1>
<div class="details">
<span id="author" class="author">Heiko Rosemann</span><br>
<span id="revnumber">version 0.3,</span>
<span id="revdate">6-27-2021</span>
<br><span id="revremark">Added v0.6 description</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_abstract">Abstract</a></li>
<li><a href="#throttle">Quickstart Guide</a>
<ul class="sectlevel2">
<li><a href="#_first_startup">First startup</a></li>
</ul>
</li>
<li><a href="#_usage">Usage</a>
<ul class="sectlevel2">
<li><a href="#_operating_locos">Operating locos</a></li>
<li><a href="#_charging_the_wifred">Charging the wiFred</a></li>
</ul>
</li>
<li><a href="#config">Configuring the wiFred</a>
<ul class="sectlevel2">
<li><a href="#_entering_configuration_mode">Entering configuration mode</a></li>
<li><a href="#_general_configuration">General configuration</a></li>
<li><a href="#_wifi_configuration">WiFi configuration</a></li>
<li><a href="#_loco_server_configuration">Loco server configuration</a></li>
<li><a href="#throttle_LocoConf">Loco configuration</a></li>
<li><a href="#throttle_FunctionConf">DCC function configuration</a></li>
<li><a href="#_wifred_status">wiFred status</a></li>
<li><a href="#_wifred_system">wiFred system</a></li>
</ul>
</li>
<li><a href="#serverSetup">Options for server setup</a>
<ul class="sectlevel2">
<li><a href="#_components_required_to_get_the_wifred_running">Components required to get the wiFred running</a></li>
<li><a href="#_out_of_the_box_server_side_options">Out-of-the-box server-side options</a></li>
<li><a href="#windowsWiFi">Step by step instructions for a Windows computer</a></li>
<li><a href="#serverWiFi">WiFi access point requirements</a></li>
<li><a href="#serverJMRI">JMRI server requirements</a></li>
<li><a href="#serverLayoutConn">Layout connection options</a></li>
<li><a href="#configurationComputer">Computer or smartphone to configure wiFred</a></li>
<li><a href="#_support_for_configuration_software">Support for configuration software</a></li>
</ul>
</li>
<li><a href="#_hardware_description">Hardware description</a>
<ul class="sectlevel2">
<li><a href="#_from_revision_0_6_onwards">From revision 0.6 onwards</a></li>
<li><a href="#_writing_the_firmware_to_the_esp32_s2_wroom">Writing the firmware to the ESP32-S2-WROOM</a></li>
<li><a href="#_hints_for_building_revision_0_6">Hints for building revision 0.6</a></li>
<li><a href="#_up_to_revision_0_5">Up to revision 0.5</a></li>
<li><a href="#hintsFor05">Hints for building revisions up to 0.5</a></li>
<li><a href="#flashing05">Writing the firmware to revision 0.5 and older wiFreds</a></li>
<li><a href="#oldThrottle">AA battery first prototype</a></li>
<li><a href="#_hints_for_building_the_wifred_aa_battery_prototype">Hints for building the wiFred AA battery prototype</a></li>
</ul>
</li>
<li><a href="#background">Background for wiFred development</a>
<ul class="sectlevel2">
<li><a href="#_specification_wishlist">Specification wishlist</a></li>
<li><a href="#_development_history">Development history</a></li>
<li><a href="#_wireless_clock">Wireless clock</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/2021-01-23-preview0001.jpg" alt="wiFred with laser engraved housing">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_abstract">Abstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document describes the usage and configuration of the wiFred - a very simple wireless throttle for model railroads to connect to wiThrottle servers like JMRI. It also contains schematics and BOMs for the device - for both LiPo battery versions in active development - as well as programming instructions and assembly tips, and also an overview of options for the server side of things.</p>
</div>
<div class="paragraph">
<p>The most recent version of this document can be found at <a href="https://newheiko.github.io/wiFred" class="bare">https://newheiko.github.io/wiFred</a>, <a href="https://github.com/newHeiko/wiFred/raw/master/documentation/docu_en.pdf" class="bare">https://github.com/newHeiko/wiFred/raw/master/documentation/docu_en.pdf</a> and <a href="https://github.com/newHeiko/wiFred/blob/master/documentation/docu_en.adoc" class="bare">https://github.com/newHeiko/wiFred/blob/master/documentation/docu_en.adoc</a>.</p>
</div>
<div class="paragraph">
<p>If you want to know more about the development history of the wiFred, skip ahead to <a href="#background">Background for wiFred development</a> - otherwise read on with <a href="#throttle">Quickstart Guide</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="throttle">Quickstart Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_first_startup">First startup</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Charge device with a micro USB charger until charging LED switches to green</p>
</li>
<li>
<p>Turn on device with charger still connected (calibrates low battery threshold)</p>
</li>
<li>
<p>Wait for red LED on top to stop flashing and stay lit</p>
</li>
<li>
<p>Use any WiFi device to search for and connect to network wiFred-configXXXX</p>
</li>
<li>
<p>Connect to <a href="http://config.local" class="bare">http://config.local</a> and configure device</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>More information can be found at <a href="https://newHeiko.github.io/wiFred" class="bare">https://newHeiko.github.io/wiFred</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_usage">Usage</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_operating_locos">Operating locos</h3>
<table id="ledTable" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. LED patterns and their meaning on the wiFred</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Red LED</th>
<th class="tableblock halign-left valign-top">Green LED (Left)</th>
<th class="tableblock halign-left valign-top">Green LED (Right)</th>
<th class="tableblock halign-left valign-top">Status</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Slow Blinking (0.5 Hz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trying to connect to WiFi network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast Blinking (2 Hz)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Successful WiFi connection, trying to connect to wiThrottle server and acquire locos</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular operation, forward direction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Regular operation, reverse direction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emergency stop, forward direction. Also happens when switching direction with speed potentiometer not at zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Emergency stop, reverse direction. Also happens when switching direction with speed potentiometer not at zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blinking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery low, regular operation, forward direction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blinking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery low, regular operation, reverse direction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blinking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery low, Emergency stop, forward direction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Blinking</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery low, Emergency stop, reverse direction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Short flashes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Throttle in low-power mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery empty or no battery inserted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No connection to existing WiFi network. Created internal configuration WiFi network</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At startup: ESTOP pressed, will reset to factory defaults after five seconds. Release key for normal startup<sup class="footnote" id="_footnote_ESP32">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At startup: SHIFT pressed, will open internal configuration WiFi network after five seconds. Release key for normal startup<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At startup: F0 pressed when connected to WiFi, will not connect to server but enable configuration mode after five seconds. Release key for normal startup<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration mode enabled while connected to existing WiFi network. All locos emergency stop to avoid runaways. Push SHIFT + ESTOP again to exit configuration mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">To recover from an emergency stop, turn speed potentiometer to zero to re-gain control.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="4"><p class="tableblock">Also see <a href="#ledTableVoltage">LED patterns and how they show battery voltage when turning off the wiFred</a> for interpreting the LED patterns when turning off all locos.</p></td>
</tr>
</tbody>
</table>
<table id="ledTableVoltage" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. LED patterns and how they show battery voltage when turning off the wiFred</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Red LED</th>
<th class="tableblock halign-left valign-top">Green LED (Left)</th>
<th class="tableblock halign-left valign-top">Green LED (Right)</th>
<th class="tableblock halign-left valign-top">Battery voltage</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Below 3.7V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between 3.7V and 3.8V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between 3.8V and 3.9V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Off</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Between 3.9V and 4.0V</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flashing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Above 4.0V</p></td>
</tr>
</tbody>
</table>
<div id="throttleControls" class="imageblock">
<div class="content">
<img src="images/DSC0690.jpg" alt="Throttle">
</div>
<div class="title">Figure 1. Controls and features of the wiFred throttle</div>
</div>
<div class="paragraph">
<p><a href="#throttleControls">Controls and features of the wiFred throttle</a> shows the controls of the wireless throttle. They consist of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Four loco selection switches (loco 1 on the left, loco 4 on the right, move towards speed potentiometer to enable)</p>
</li>
<li>
<p>Speed potentiometer (Counter-clockwise endstop: Stop, clockwise endstop: Full speed)</p>
</li>
<li>
<p>Direction switch - move right for forward movement, left for reverse movement</p>
</li>
<li>
<p>Black function keys F0 to F8</p>
</li>
<li>
<p>Yellow shift key to trigger F9-F16 and turn on flashlight function</p>
</li>
<li>
<p>Red emergency stop key</p>
</li>
<li>
<p>Two green direction indicator LEDs next to speed potentiometer</p>
</li>
<li>
<p>Red status LED next to speed potentiometer</p>
</li>
<li>
<p>Red charging indicator LED at lower end of device - lit while charging</p>
</li>
<li>
<p>Green fully charged indicator LED at lower end of device - lit when fully charged as long as charger still connected</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As soon as any of the loco selection switches is moved into the "enabled" position, the throttle will boot up and try to connect to a wireless network. When all four loco selection switches are "disabled", the throttle will disconnect from the wireless network after a grace period of five seconds. The device will then go into low power mode, in which the battery will last for more than a year.</p>
</div>
<div class="paragraph">
<p>If no connection to the network configured into the device can be established within 60 seconds, the throttle will create it&#8217;s own wireless network named <strong>wiFred-config</strong> plus six hex digits taken from the MAC address of the throttle WiFi interface, for example <strong>wiFred-config61FB7B</strong>, to enable configuration as described in <a href="#config">Configuring the wiFred</a>.</p>
</div>
<div class="paragraph">
<p>Four different locos with long DCC addresses can be assigned to the four loco selection switches. Commands derived from the speed potentiometer, the direction switch and the function keys will be transmitted to all selected locos (near) simultaneously, with a certain translation table enabling some locos to go backwards when others go forwards and also limiting function keys to some of the four locos only - this is described in more detail in <a href="#throttle_LocoConf">Loco configuration</a> and <a href="#throttle_FunctionConf">DCC function configuration</a>.</p>
</div>
<div class="paragraph">
<p>Pushing the red emergency stop key will cause the throttle to send an emergency stop signal to all four locos attached. After an emergency stop, turn the speed potentiometer to zero to re-enable control of the locos.</p>
</div>
<div class="paragraph">
<p>Pushing the red emergency stop key while holding down the shift key will place the device into configuration mode (as well as issueing an emergency stop to all attached locos). See <a href="#config">Configuring the wiFred</a> for more details on how to access the throttle to do the configuration.</p>
</div>
<div class="paragraph">
<p>Any change in the loco selection switches will cause the throttle to send an emergency stop command to all attached locos. This makes sure that any loco that is deselected will stop on the layout and avoids newly selected locos suddenly taking off at speed. The same is true for a change in the direction switch, to avoid high-speed reverse maneuvers. Turn the speed potentiometer to zero to re-enable control of the locos.</p>
</div>
<div class="paragraph">
<p>When the battery is low, the device will not re-activate before charging the batteries, but continue operating for approximately an hour if active. When the battery is empty, it will disconnect and enter low power mode. Expected runtime is around 20 hours of full time operations, more if the throttle is placed in low power mode when the locos are not running.</p>
</div>
<div class="paragraph">
<p>During startup and operation, the LEDs will show the patterns explained in <a href="#ledTable">LED patterns and their meaning on the wiFred</a>. After turning off the wiFred, the LEDs will show the current battery voltage for a few seconds, as described in <a href="#ledTableVoltage">LED patterns and how they show battery voltage when turning off the wiFred</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_charging_the_wifred">Charging the wiFred</h3>
<div class="paragraph">
<p>The wiFred can be charged through the Micro-USB connector at the lower end of the device. Maximum charging current is approximately 400 mA and the device does not communicate with the USB host, so technically there is no guarantee that charging from a USB cable will work, but most chargers, computer ports or power banks do not check the current before powering up.</p>
</div>
<div class="paragraph">
<p>As long as the battery is being charged, the red charging indicator LED will be lit. When the battery is fully charged, the green charged indicator LED will be lit as long as the charger is still connected. Expected charging time is around five to six hours for a full charge.</p>
</div>
<div class="paragraph">
<p>Even while charging, the device can still be operated (particularly helpful with a power bank) but since the operating current will come out of the battery, the battery will never be fully charged.</p>
</div>
<div class="paragraph">
<p>If both charging status LEDs light up when a charging cable is connected, probably the internal connection to the battery is faulty.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config">Configuring the wiFred</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before using the device, it must be configured. At the very least, the General Configuration page <a href="#throttleConfMainPage">Screenshot of wiFred main configuration page</a> has to be submitted once to be saved to non-volatile memory. If no valid configuration is detected at startup, the device will start with a default configuration with no locos enabled and no WiFi settings, so it won&#8217;t be able to connect to any WiFi network.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/important.png" alt="Important">
</td>
<td class="content">
After entering any kind of text (names, numbers&#8230;&#8203;) into text fields, the corresponding "Save" button has to be pressed to submit the changes to the wiFred.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_entering_configuration_mode">Entering configuration mode</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
The wiFred is designed to be configured in configuration mode. If the IP address or the name of the throttle during normal operation is known, the configuration pages can also be accessed by pointing a web browser to it at any time while it is connected. This is mostly untested and therefore not recommended while the throttle is running locos, as it may lead to a temporarily inconsistent configuration. At the very least, deactivating and re-activating a loco with the respective loco selection switch will be required for changed settings to take effect.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are four ways to enter configuration mode:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Power up the throttle/select a loco when the configured WiFi network is not in range (or when there is no valid configuration - the first startup of a new throttle will fall into this category)</p>
</li>
<li>
<p>Power up the throttle/select a loco while holding down SHIFT for five seconds<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
<li>
<p>Press SHIFT and ESTOP together when the throttle is connected</p>
</li>
<li>
<p>Press F0 for five seconds while / after the device has connected to a WiFi network<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the first two cases, the throttle will create a wireless network named <strong>wiFred-config</strong> plus six hex digits taken from the MAC address of the throttle WiFi interface, for example <strong>wiFred-config61FB7B</strong> and announce its presence under the name <strong>config.local</strong> as well as creating a captive portal. Any WiFi device with a web browser can connect to that network and open a web browser to point to <strong><a href="http://192.168.4.1" class="bare">http://192.168.4.1</a></strong> or <strong><a href="http://config.local" class="bare">http://config.local</a></strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
This has been tested with Mozilla Firefox and Opera on Linux with Avahi (a Zeroconf implementation), FOSS Browser on Android 9/10 and Safari on iOS 13/14.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the third and fourth case, the throttle will only announce its presence under the name <strong>config.local</strong> using the Bonjour/Zeroconf-protocol. Any device on the same WiFi network with Bonjour/Zeroconf can use a web browser to access the configuration at <strong><a href="http://config.local" class="bare">http://config.local</a></strong>. See <a href="#configurationComputer">Computer or smartphone to configure wiFred</a> for an explanation what is required to have your device read Bonjour/Zeroconf announcements.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
This has been tested with Mozilla Firefox and Opera on Linux with Avahi (a Zeroconf implementation) and BonjourBrowser on Android 10.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="#throttleConfMainPage">Screenshot of wiFred main configuration page</a> shows the first page you will see when you point a web browser at your wiFred throttle. It is divided into multiple sections explained in the following chapters.</p>
</div>
<div id="throttleConfMainPage" class="imageblock">
<div class="content">
<img src="images/wiFred_configuration_page.png" alt="wiFred main configuration page">
</div>
<div class="title">Figure 2. Screenshot of wiFred main configuration page</div>
</div>
</div>
<div class="sect2">
<h3 id="_general_configuration">General configuration</h3>
<div class="paragraph">
<p>In the "General configuration" section there is only one configuration option: The throttle name. This is a free-form identification string of the throttle. It shows up in the wiThrottle window of JMRI as shown in <a href="#withrottleScreenshot">Screenshot of wiThrottle screen showing one throttle connected</a> and can be used to identify the throttle during configuration.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
The wiFred also announces its presence on the WiFi network through Bonjour/Zeroconf using a sanitized version of the name, i.e. a throttle called "Heiko Prototype 2-2" will announce its presence as <strong>heikoprototype22.local</strong> when not in configuration mode.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wifi_configuration">WiFi configuration</h3>
<div class="paragraph">
<p>The "WiFi configuration" section shows a list of configured WiFi networks. The wiFred will connect to any network in this list, choosing the strongest one if multiple configured networks are in range.</p>
</div>
<div class="paragraph">
<p>Existing entries can be removed by clicking on the "Remove SSID" button in the line of the network that shall be removed.</p>
</div>
<div class="paragraph">
<p>New entries can be added either by manually entering the SSID and PSK<sup class="footnote" id="_footnote_PSK">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> if required and clicking the "Manually add network" button or by clicking on the "Scan for networks" link which takes the user to the page shown in <a href="#throttleConfWiFiPage">Screenshot of wiFred "Scan for WiFi"-page</a>.</p>
</div>
<div id="throttleConfWiFiPage" class="imageblock">
<div class="content">
<img src="images/wiFred_wifi-scan_page.png" alt="Scan for WiFi page">
</div>
<div class="title">Figure 3. Screenshot of wiFred "Scan for WiFi"-page</div>
</div>
<div class="paragraph">
<p>This page will take a few seconds to load, since the scan for networks has to be completed first. It shows all the networks found during the scan. Networks can be added to the list by clicking the "Add network" button, after entering the PSK<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup> in the field next to it.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
The wiFred does not support WPS and it won&#8217;t accept multiple networks with the same SSID but different PSKs. More details regarding the network requirements can be found in <a href="#serverSetup">Options for server setup</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The new WiFi configuration will not be activated until the wiFred is restarted, either through a power-cycle or by clicking on the "Restart wiFred to enable new WiFi-settings" link on the configuration page.</p>
</div>
</div>
<div class="sect2">
<h3 id="_loco_server_configuration">Loco server configuration</h3>
<div class="paragraph">
<p>Following the WiFi configuration, the section "Loco server configuration" allows configuring the wiThrottle server to which the wiFred shall connect. The default setting - automatically detect server - works well if there is only one wiThrottle server on the network. It will connect to any server announcing its presence on port 12090 through Zeroconf/Bonjour, the result of the Zeroconf/Bonjour-search will be shown here when the wiFred has automatically discovered a server.</p>
</div>
</div>
<div class="sect2">
<h3 id="throttle_LocoConf">Loco configuration</h3>
<div class="paragraph">
<p>Following the "Loco server configuration", there are four identical sections assigned to the four different locomotives which can be controlled with this throttle. Each section consists of the following settings:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DCC address</dt>
<dd>
<p>Can be a short address between 1 and 127 (also used for consists) or a long address between 0 and 10239.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
Short addresses between 1 and 127 are not the same as long addresses between 1 and 127, and many DCC systems do not support all those addresses.<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup> A DCC address that the DCC system does not support is silently ignored.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If this is set to -1, the corresponding loco is disabled.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Long address?</dt>
<dd>
<p>Checkbox to change the behaviour of the DCC address input field described above.</p>
</dd>
<dt class="hdlist1">Direction</dt>
<dd>
<p>This has three options:</p>
<div class="ulist">
<ul>
<li>
<p>Forward: Loco will travel forwards if wiFred is set to forwards and vice versa</p>
</li>
<li>
<p>Reverse: Loco will travel backwards if wiFred is set to forwards and vice versa</p>
</li>
<li>
<p>Don&#8217;t change: Loco will continue to travel in the same direction it was set to when it was activated and switch direction when the wiFred switches direction</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Function mapping</dt>
<dd>
<p>Link to the function mapping subpage for the corresponding loco, as described in <a href="#throttle_FunctionConf">DCC function configuration</a>. Clicking this link will lose all information entered on the current page and take the web browser to a different subpage.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/important.png" alt="Important">
</td>
<td class="content">
Reminder: Changes are saved using the "Save loco config" button which
may look different in different web browsers (firefox shown).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="throttle_FunctionConf">DCC function configuration</h3>
<div class="paragraph">
<p>By default, if a function key is pressed, the throttle will send the appropriate commands to every loco under control. Under certain circumstances, this may not be desired - the obvious example being a loco in the middle of a multi-unit consist, which should not have lights or ditchlights. So this page - shown in <a href="#throttleConfigFunctionPage">Screenshot of wiFred function handling config page</a> - offers the option to chose between three different settings for every function on each of the four locomotives (one page per locomotive):</p>
</div>
<div id="throttleConfigFunctionPage" class="imageblock">
<div class="content">
<img src="images/wiFred_function_page.png" alt="wiFred function page">
</div>
<div class="title">Figure 4. Screenshot of wiFred function handling config page</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Throttle controlled</dt>
<dd>
<p>When the first loco is enabled by moving the selection switch to the "selected" position, the current status of the function is queried and saved. When selecting the next loco, the function status is set to be the same. Afterwards, key presses are handed through to the loco. Whether the function will be momentary<sup class="footnote" id="_footnote_MOM">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> or locking<sup class="footnote" id="_footnote_TOG">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> will be determined by the server, in the case of JMRI by the roster entry.</p>
</dd>
<dt class="hdlist1">Throttle controlled, force momentary</dt>
<dd>
<p>Function key will be handed through to the loco as a momentary<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup> function.</p>
</dd>
<dt class="hdlist1">Throttle controlled, force locking</dt>
<dd>
<p>As described for <strong>Throttle controlled</strong> but the function will be forced to be locking<sup class="footnoteref">[<a class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup> regardless of the server settings<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup>.</p>
</dd>
<dt class="hdlist1">Throttle controlled if this is the only loco</dt>
<dd>
<p>As described for <strong>Throttle controlled, force locking</strong> but the function key will only be toggling the function if no other loco is enabled. This allows for i.e. turning headlights and rearlights on and off on individual locos before assembling a consist.</p>
</dd>
<dt class="hdlist1">Force function always on</dt>
<dd>
<p>The function will be forced on when the loco is activated and kept on regardless of key presses<sup class="footnote">[<a id="_footnoteref_7" class="footnote" href="#_footnotedef_7" title="View footnote.">7</a>]</sup>.</p>
</dd>
<dt class="hdlist1">Force function always off</dt>
<dd>
<p>The function will be forced off when the loco is activated and kept off regardless of key presses.</p>
</dd>
<dt class="hdlist1">Ignore function key</dt>
<dd>
<p>No function commands will be sent to this loco.</p>
</dd>
</dl>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<img src="images/icons/important.png" alt="Important">
</td>
<td class="content">
Reminder: Changes are saved using the "Save function configuration" button which may look different in different web browsers (firefox shown).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wifred_status">wiFred status</h3>
<div class="paragraph">
<p>The "wiFred status" section shows the current battery voltage, as
measured by the wiFred. This is updated on reloading the page, not
continuosly.</p>
</div>
<div class="paragraph">
<p>It also shows the current firmware version(s).</p>
</div>
</div>
<div class="sect2">
<h3 id="_wifred_system">wiFred system</h3>
<div class="paragraph">
<p>In the wiFred system section of the configuration page, various settings related to the hardware can be changed.</p>
</div>
<div class="paragraph">
<p>The first setting concerns wiFreds with an On-Off-On direction switch and determines what the center position will do. The options are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Ignore</dt>
<dd>
<p>Don&#8217;t do anything special when the switch is in the center position - just continue as before, same direction, speed controlled by speed potentiometer. Reversing entirely will trigger an emergency stop.</p>
</dd>
<dt class="hdlist1">Zero speed</dt>
<dd>
<p>Keep the direction but send out zero speed to all locos. This setting is intended for locos with high momentum settings. Reversing quicker than within half a second will trigger an emergency stop, otherwise the locos will resume their old speed setting in the opposite direction.<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnotedef_8" title="View footnote.">8</a>]</sup></p>
</dd>
<dt class="hdlist1">Set F&lt;n&gt;</dt>
<dd>
<p>Simulates a function key press when switching from forward to center position and a key release when switching from center position to reverse (and vice versa).<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnotedef_9" title="View footnote.">9</a>]</sup> This is intended for locos with either a brake function or ESU&#8217;s Drive Hold on a function key. The speed commands sent to the loco will still be controlled by the speed potentiometer while the direction switch is in the center position. Reversing quicker than within half a second will trigger an emergency stop, otherwise the throttle will continue to send speed commands according to the speed potentiometer position.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The section concludes with two links:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Reset wiFred to factory defaults - which leads to a confirmation page shown in <a href="#throttleConfResetPage">Screenshot of wiFred configuration reset page</a> to reset all configuration data to factory defaults as on a new wiFred.</p>
</li>
<li>
<p>Update wiFred firmware - which leads to a firmware update page shown in <a href="#throttleConfUpdatePage">Screenshot of wiFred firmware update page</a> to update the wiFred firmware of the ESP8266 / ESP32-S2. Find the .bin-file from the arduino build folder or from the <a href="#github">[Github repository for wiFred]</a>, click on "Browse", navigate to the .bin-file and finally initiate the update with a click on "Update Firmware" - which will take a while.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
It may be necessary to power down the wiFred entirely for a firmware update to restart properly.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
On a wiFred version from 0.6 onwards with an ESP32-S2 MCU, resetting to factory defaults can also be done by holding down the ESTOP key for five seconds at startup.
</td>
</tr>
</table>
</div>
<div id="throttleConfResetPage" class="imageblock">
<div class="content">
<img src="images/wiFred_reset_page.png" alt="wiFred configuration reset page">
</div>
<div class="title">Figure 5. Screenshot of wiFred configuration reset page</div>
</div>
<div id="throttleConfUpdatePage" class="imageblock">
<div class="content">
<img src="images/wiFred_update_page.png" alt="wiFred firmware update page">
</div>
<div class="title">Figure 6. Screenshot of wiFred firmware update page</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="serverSetup">Options for server setup</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_components_required_to_get_the_wifred_running">Components required to get the wiFred running</h3>
<div id="withrottleScreenshot" class="imageblock">
<div class="content">
<img src="images/withrottle_Screenshot.jpg" alt="wiThrottle screen">
</div>
<div class="title">Figure 7. Screenshot of wiThrottle screen showing one throttle connected</div>
</div>
<div class="paragraph">
<p><a href="#runningTrains">Overview of devices required to run trains with the wiFred</a> shows the connections between the devices required to run trains using the wiFred.</p>
</div>
<div id="runningTrains" class="imageblock">
<div class="content">
<img src="images/runningTrains.png" alt="Devices required to run trains with a wiFred">
</div>
<div class="title">Figure 8. Overview of devices required to run trains with the wiFred</div>
</div>
<div class="paragraph">
<p>The symbols in <a href="#runningTrains">Overview of devices required to run trains with the wiFred</a> symbolize the following parts:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An IEEE 802.11b/g/n 2.4 GHz WiFi access point described in detail in <a href="#serverWiFi">WiFi access point requirements</a></p>
</li>
<li>
<p>A PC or laptop computer with Windows, Linux or MacOS to run the JMRI server described in detail in <a href="#serverJMRI">JMRI server requirements</a></p>
</li>
<li>
<p>A way to connect the JMRI server to the model railroading layout described in detail in <a href="#serverLayoutConn">Layout connection options</a></p>
</li>
<li>
<p>A device with a web browser connected to the same network as the wiFred to configure it - can be the same physical device as the one running the server, if it meets the requirements in <a href="#configurationComputer">Computer or smartphone to configure wiFred</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Multiple options for every step or combining these steps are described in the following sections.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
Basically, if a layout is set up to run trains with a smartphone running wiThrottle or EngineDriver, a wiFred should work with no changes to the layout configuration. If a layout is set up in a way that trains can be run from a JMRI screen throttle on a computer, only a WiFi connection to the JMRI computer needs to be added.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_out_of_the_box_server_side_options">Out-of-the-box server-side options</h3>
<div class="paragraph">
<p>A pretty much out-of-the-box solution for a Raspberry Pi is provided by <a href="#rpiImage">[Steve Todd]</a>, which creates its own WiFi network, auto-detects multiple options to interface to a DCC layout and starts a wiThrottle server. It has been tested in the JMRI 4.16 and JMRI 4.20 versions to work with the wiFred, connecting to a Z21 black through both an RRCircuits LocoBuffer USB and a Digitrax PR3 via Loconet.</p>
</div>
<div class="paragraph">
<p>Although untested so far, adding a <a href="#Digitrax">[Digitrax LNWI]</a> to a Digitrax system or an <a href="#MRC">[MRC Prodigy WiFi]</a> to an MRC system should allow the wiFred to run locos out-of-the-box as well.</p>
</div>
</div>
<div class="sect2">
<h3 id="windowsWiFi">Step by step instructions for a Windows computer</h3>
<div class="paragraph">
<p>This has been tested on a Windows 7 64Bit laptop computer with a 2.4GHz WiFi card inside the PC.</p>
</div>
<div class="sect3">
<h4 id="_installation">Installation</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install <a href="https://www.nirsoft.net/utils/wifi_hotspot_starter.html">HostedNetworkStarter</a></p>
</li>
<li>
<p>Install <a href="https://www.dhcpserver.de/cms/download/">DHCP server</a> - download and extract all the files from the zip file to somewhere on your harddrive, for example C:\DHCPServer</p>
</li>
<li>
<p>Install a JDK, version 8 and 11 have been tested. For example, <a href="https://adoptopenjdk.net/releases.html">Version OpenJDK 11 (LTS), JVM HotSpot</a>. Choose the 64bit version for most modern hardware, 32bit only if you are running a 32bit operating system. Easiest option: MSI file, download and install.</p>
</li>
<li>
<p>Install <a href="https://www.jmri.org">JMRI</a> - versions tested to run with the wiFred include 4.14, 4.16, 4.18 and 4.20. Most recent production version recommended.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
Windows 10 provides a Hotspot feature that will work in place of HostedNetworkStarter and DHCP server, so you can jump right into installing JDK and JMRI.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">Configuration</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start HostedNetworkStarter from the start menu, enter a Network Name and Network Key, then hit the Start button. Note the "Hosted Network Connection Name" for the next step</p>
</li>
<li>
<p>Start the DHCP server wizard from C:\DHCPServer\dhcpwiz.exe, select the network with the name that&#8217;s the same as the "Hosted Network Connection Name" from the step before, hit "Next" a few times (deselecting all additional supported protocols), Write INI file, Start Service and Configure Firewall Exceptions</p>
</li>
<li>
<p>Start JMRI using the DecoderPro icon on the desktop, setup your layout connection, test if you can run a loco with a JMRI throttle</p>
</li>
<li>
<p>Within JMRI, start the WiThrottle Server from the Actions menu. If a firewall popup comes up, allow all.</p>
</li>
<li>
<p>Within JMRI, edit the Preferences from the Edit menu, choose WiThrottle on the left pane, click the "Start automatically with application" checkbox. All the Allowed Controls can be disabled.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_running">Running</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start HostedNetworkStarter from the start menu, enter a Network Name and Network Key, then hit the Start button.</p>
</li>
<li>
<p>Start JMRI using the DecoderPro icon on the desktop</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverWiFi">WiFi access point requirements</h3>
<div class="paragraph">
<p>The wiFred will work on basically any 2.4GHz IEEE802.11b or -g WiFi network that will accept new devices and provide them with an IPv4 address through a DHCP server. It supports open networks or WPA2 encryption, though not WPS.</p>
</div>
<div class="paragraph">
<p>It has successfully been tested with a FRITZ!Box, a random cable router, multiple public WiFi networks and several software hotspots including Linux hostapd both on a first generation Intel Atom netbook and a Raspberry Pi, the Windows 10 Hotspot and a Windows 7 software as described in <a href="#windowsWiFi">Step by step instructions for a Windows computer</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
Some WiFi access points and routers offer a feature called "Wireless Isolation" or similar that will forbid connected devices from connecting to each other. This feature should be disabled for wiFreds to find their server and to be configured.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="serverJMRI">JMRI server requirements</h3>
<div class="paragraph">
<p>Any PC that can run at least Java 8 will be able to run the JMRI server. Even old 32Bit first generation netbook computers like the 2008 Eee-PC have more than enough computing power for that task. There are JMRI versions for Windows, Linux or MacOS available, so any of these operating systems should be fine.</p>
</div>
</div>
<div class="sect2">
<h3 id="serverLayoutConn">Layout connection options</h3>
<div class="paragraph">
<p><a href="#JMRI">[JMRI]</a> supports a multitude of different connections to the layout as described in <a href="#jmrihardwaresupport">[Supported Hardware]</a>. In general, if a JMRI installation can run a loco on the layout, it&#8217;s a simple matter of connecting the JMRI computer to a WiFi access point (if not already connected) and starting the wiThrottle server from the Actions-menu inside DecoderPro.</p>
</div>
<div class="paragraph">
<p>The wiFred has been tested to work with a LocoBufferUSB or a Digitrax PR3 connected via Loconet to an Intellibox, a Z21 black, a DCS 51 Zephyr xtra or a Minibox 2 DIY DCC central station. It has also been used to run a loco on a SPROG programmer.</p>
</div>
</div>
<div class="sect2">
<h3 id="configurationComputer">Computer or smartphone to configure wiFred</h3>
<div class="paragraph">
<p>Webbrowser, Zeroconf. Avahi. Bonjour (iTunes?). MacOS out of the box?
iOS? Android?</p>
</div>
<div class="paragraph">
<p>For initial configuration of the wiFred, most of the devices mentioned above can be omitted. As shown in <a href="#confWifred">For initial configuration, the requirements are very small</a>, only a WiFi capable device with a web browser is required.</p>
</div>
<div id="confWifred" class="imageblock">
<div class="content">
<img src="images/configuringWifred.png" alt="Configuring wiFred">
</div>
<div class="title">Figure 9. For initial configuration, the requirements are very small</div>
</div>
<div class="paragraph">
<p>Tested with iOS 13 and iOS 14, Android 9 and 10 as well as Firefox on Linux, the initial configuration page is automatically loaded when the device is connected to the <strong>wiFred-configXXXX</strong>-network.</p>
</div>
<div class="paragraph">
<p>For regular configuration, once the wiFred has successfully connected to a WiFi network and put into configuration mode, Bonjour/Zeroconf/mDNS support is required to find the device announcing itself as <a href="http://config.local" class="bare">http://config.local</a>. This service is provided on Linux by a software package called avahi, should work out of the box on iOS and MacOS and can be installed on Windows with iTunes. For mobile operating systems, there are apps called Discovery for iOS and BonjourBrowser for Android which not only translate <a href="http://config.local" class="bare">http://config.local</a> to point to the configuration website of the one wiFred on the network that is in configuration mode but also browse all wiFreds currently announcing their presence. <a href="#bonjourBrowser">User interface of BonjourBrowser, showing two wiFreds active on the network.</a> shows a screenshot of the Android version. Clicking on a device will open a browser to its configuration website.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<img src="images/icons/note.png" alt="Note">
</td>
<td class="content">
The wiFred is designed to be configured in configuration mode. If the IP address or the name of the throttle during normal operation is known, the configuration pages can also be accessed by pointing a web browser to it at any time while it is connected. This is mostly untested and therefore not recommended while the throttle is running locos, as it may lead to a temporarily inconsistent configuration. At the very least, deactivating and re-activating a loco with the respective loco selection switch will be required for changed settings to take effect.
</td>
</tr>
</table>
</div>
<div id="bonjourBrowser" class="imageblock">
<div class="content">
<img src="images/bonjourBrowser.png" alt="BonjourBrowser with two wiFreds" width="50%">
</div>
<div class="title">Figure 10. User interface of BonjourBrowser, showing two wiFreds active on the network.</div>
</div>
</div>
<div class="sect2">
<h3 id="_support_for_configuration_software">Support for configuration software</h3>
<div class="paragraph">
<p>To support a specialized configuration software, the wiFred will send a UDP broadcast upon successfully connecting to a WiFi network and present its configuration at /api/getConfigXML.</p>
</div>
<div class="paragraph">
<p>For more information, contact <a href="mailto:wiFred@bornwnd.de">Detlef Born</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hardware_description">Hardware description</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_from_revision_0_6_onwards">From revision 0.6 onwards</h3>
<div class="paragraph">
<p>The wiFred hardware is centered around an ESP32-S2-WROOM module that controls the LEDs and reads the switches, push buttons and speed potentiometer. It gets its power from a single cell LiPo battery through a 3.3V low drop linear voltage regulator that is activated directly from the loco selection switches combined through a set of diodes. An RC lowpass will delay turning off the wiFred by a couple of seconds.</p>
</div>
<div class="paragraph">
<p>Optionally, two white 5 mm-LEDs protruding from the top of the PCB can be installed to serve as a flashlight. They are driven by a constant-current source directly from the battery and enabled when pushing the yellow SHIFT key.</p>
</div>
<div class="paragraph">
<p>The ESP32-S2 also monitors the battery voltage, going into sleep mode when the battery voltage drops too low. This should drop power consumption to a reasonably safe value, even though not as low as it can go when all the loco selection switches are off. Charging the battery can be done through the integrated USB port with two LEDs showing the charging status.</p>
</div>
<div class="paragraph">
<p>The schematic is split into several pages and can be found in <a href="#schematic06page1">Master schematic sheet with battery connector, charging circuit and power supply</a> to <a href="#schematic06page3">Schematic sheet for user interface (Keys, switches, LEDs, poti and flashlight)</a>. It has been created with kicad and is available on the <a href="#github">[Github repository for wiFred]</a> along with the PCB design.</p>
</div>
<div id="schematic06page1" class="imageblock">
<div class="content">
<img src="images/wfred_rev6.png" alt="&quot;Schematic sheet 1 for rev0.6">
</div>
<div class="title">Figure 11. Master schematic sheet with battery connector, charging circuit and power supply</div>
</div>
<div id="schematic06page2" class="imageblock">
<div class="content">
<img src="images/wfred-wifi_rev6-Wifi_connection.png" alt="&quot;Schematic sheet 2 for rev0.6">
</div>
<div class="title">Figure 12. Schematic sheet including ESP32-S2-WROOM for WiFi connection with bootloader enabling jumper and connection to programming cable</div>
</div>
<div id="schematic06page3" class="imageblock">
<div class="content">
<img src="images/User_interface_rev6-User_Interface.png" alt="&quot;Schematic sheet 3 for rev0.6">
</div>
<div class="title">Figure 13. Schematic sheet for user interface (Keys, switches, LEDs, poti and flashlight)</div>
</div>
</div>
<div class="sect2">
<h3 id="_writing_the_firmware_to_the_esp32_s2_wroom">Writing the firmware to the ESP32-S2-WROOM</h3>
<div class="paragraph">
<p>To place the ESP32-S2 into firmware flashing mode, a jumper has to be installed on the BOOT pins as shown in <a href="#bootJumper06">Display of boot jumper - left from 0.6 prototype, right from 0.62 rendering</a> when the device is powered up. After entering boot mode, the ESP32-S2 will register as a USB CDC device when connected to a PC and can be programmed through it. Alternately, the serial port at the TXD/RXD pins can be used. The serial port needs to be at 3.3 V-levels like from an FTDI232-device run at 3.3 V.</p>
</div>
<div id="bootJumper06" class="imageblock">
<div class="content">
<img src="images/wfred_rev62BootJumper.png" alt="Boot jumper for 0.6 wiFred">
</div>
<div class="title">Figure 14. Display of boot jumper - left from 0.6 prototype, right from 0.62 rendering</div>
</div>
<div class="paragraph">
<p>All files in the <strong>software/esp-firmware</strong>-subdirectory of the <a href="#github">[Github repository for wiFred]</a> need to be placed in a folder, then the main sketch <strong>esp-firmware.ino</strong> needs to be opened with the Arduino IDE. Settings for the Arduino IDE can be found inside the main file, programming the device should work using the <strong>Upload</strong>-button in the <strong>Sketch</strong>-menu. An alternate solution using a pre-compiled firmware and esptool.py may be documented in the future.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hints_for_building_revision_0_6">Hints for building revision 0.6</h3>
<div class="paragraph">
<p>All the SMD parts and connectors in <a href="#BOM06SMD">List of bottom side components - SMDs and pin headers - for the wiFred PCB from revision 0.6</a> are located on the bottom side, so they can easily be installed by an automated PCB assembly service. Gerber files and location files will be made available on the <a href="#github">[Github repository for wiFred]</a>. They are no smaller than 0805, though, so it should be possible for experienced electronics hobbyists to hand-solder them as well, although the USB-C-connector has a very small pitch.</p>
</div>
<table id="BOM06SMD" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 3. List of bottom side components - SMDs and pin headers - for the wiFred PCB from revision 0.6</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Designator</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Designation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C106, C105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22p</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C201, C302, C102, C203, C202, C104, C101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4u7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C303, C301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C308, C307, C306, C305, C103, C304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D103, D204, D203, D202, D201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT-23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAT54C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT-23-5_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TP4054</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT-23-5_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XC6220B331MR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT-23-6_Handsoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CAT4002ATD-GT3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB_C_Receptacle_HRO_TYPE-C-31-M-12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB_C_Receptacle_USB2.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PinHeader_2x03_P2.54mm_Vertical</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Conn_02x03_Odd_Even</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PinHeader_1x02_P2.54mm_Horizontal</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BATT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R102, R101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R103, R209, R208, R207, R104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">680R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R105</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2k2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R107, R106</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5k1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R212, R302, R301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4M7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R303, R304, R206, R211, R205, R204, R203, R202, R201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">R_0805_2012Metric_Pad1.15x1.40mm_HandSolder</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4k7</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Then - as shown in <a href="#BOM06TOP">List of top side components - ESP32-S2-WROOM and user interface - for the wiFred PCB from revision 0.6</a> - there is only the ESP32-S2-WROOM module on the top of the PCB and all the switches, push buttons, potentiometer and LEDs. After installing the ESP32-S2-WROOM, the direction switch should be screwed into the PCB with an 8 mm hex nut first, then attached to it&#8217;s pads using the cutoffs from the LEDs, and the speed potentiometer should be screwed into the PCB with a 10 mm hex nut before soldering its leads.</p>
</div>
<div class="paragraph">
<p>For all other switches, push buttons and LEDs, it is recommended to drill the holes in the housing first, then place the parts on the PCB and screw the PCB into the housing before soldering the parts. Holes for the pushbutton switches should be drilled at 3.5 mm diameter. Holes for the LEDs should be drilled at 3 mm diameter and holes for the speed potentiometer at 8 mm, for the direction switch at 6.5 mm diameter. The cutouts for the loco selection switches are best drilled at 1.5 mm and extended to fit with a jigsaw or a sharp hobby knife and a file. The easiest approach is a laser engraved housing - PDF and DXF files of the markings are available on the <a href="#github">[Github repository for wiFred]</a> as well.</p>
</div>
<table id="BOM06TOP" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 4. List of top side components - ESP32-S2-WROOM and user interface - for the wiFred PCB from revision 0.6</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Designator</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Designation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED - red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D205</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOP - red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D206</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORWARD - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D207</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REVERSE - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D208</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D5.0mm_Horicontal_FLIPPED_O1.27mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cree C543A-WMN-CCCKK141</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D209</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D5.0mm_Horizontal_O1.27mm_Z3.0mm_Clear</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cree C543A-WMN-CCCKK141</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P160KNPD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10k lin P160KNPD-4FC20B10K</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW203</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESTOP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW205</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW206</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW207</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW208</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW209</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW210</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW211</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW212</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW213</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW214</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW215</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_PUSH_6mm_H9.5mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHIFT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW216</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100SP1T1B1M1QEH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIRECTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP32-S2-WROVER-HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP32-S2-WROOM</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To form a complete BOM, also include the parts listed in <a href="#BOM06extra">List of components for the wiFred from revision 0.6 excluding electronic parts to solder to PCB</a> which are not soldered to the PCB but used in assembly later on.</p>
</div>
<table id="BOM06extra" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. List of components for the wiFred from revision 0.6 excluding electronic parts to solder to PCB</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Designator</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Designation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lithium battery 1700mAh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H1a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Housing black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strapubox 2090</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or H1b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Housing white</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strapubox 2090</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumper</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K1a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Potentiometer Knob silver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or K1b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Potentiometer Knob black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">124mm x 35mm x 1.6mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S1, S2, S3, S4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounting Screws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,9mm x 6,5mm</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After assembling the PCB with all the components, the holes and cutouts in the enclosure most likely will have to be reworked / extended to actually fit the PCB, then the PCB can be screwed into the enclosure with four screws. Afterwards the battery should be connected to the BATT connector making sure the orientation is correct as shown in <a href="#battConnection06">Connection of battery to P101 on revision 0.6 and up - black wire is GND, red wire is positve</a> and printed on the PCB, then the battery should be glued to the bottom of the enclosure with double-sided tape so it does not collide with any parts on the PCB, particularly the pin headers and the direction switch.</p>
</div>
<div id="battConnection06" class="imageblock">
<div class="content">
<img src="images/DSC0779.jpg" alt="Battery connection">
</div>
<div class="title">Figure 15. Connection of battery to P101 on revision 0.6 and up - black wire is GND, red wire is positve</div>
</div>
<div id="drilljigPicture" class="imageblock">
<div class="content">
<img src="images/DSC0126.jpg" alt="Drilljig">
</div>
<div class="title">Figure 16. Using the original PCB and drilling jig to transfer the positions of the holes to the housing - better results will be achieved when the PCBs are screwed in position</div>
</div>
<div id="battConnection" class="imageblock">
<div class="content">
<img src="images/DSC0148.jpg" alt="Battery connection">
</div>
<div class="title">Figure 17. Connection of battery to P101 on revision 0.4 - black wire is GND, red wire is positive</div>
</div>
</div>
<div class="sect2">
<h3 id="_up_to_revision_0_5">Up to revision 0.5</h3>
<div class="paragraph">
<p>The wiFred hardware is centered around an ESP8266 for the WiFi connection. The ESP8266 communicates through its serial port with an ATMega 328P microcontroller which manages the power, controls the LEDs, reads the loco selection switches, speed potentiometer, direction switch and pushbutton switches for functions and emergency stop. The communication goes through a 2x3 pin header which enables the user to connect a programming cable to the same serial port if removing the jumpers.</p>
</div>
<div class="paragraph">
<p>Optionally, two white 5 mm-LEDs protruding from the top of the PCB can be installed to serve as a flashlight. They are driven by a constant-current source directly from the battery and enabled when pushing the yellow SHIFT key.</p>
</div>
<div class="paragraph">
<p>The wiFred is powered by a single cell LiPo battery. The ATMega 328P is connected directly to the LiPo cell, going into sleep mode when no loco selection switch is active, thereby reducing the power consumption to less than 1 µA. The ESP8266 is powered by a low-drop linear voltage regulator with an output voltage of 3 V which is disabled by the ATMega 328P when the device goes into standby.</p>
</div>
<div class="paragraph">
<p>The schematic is split into several pages and can be found in <a href="#schematic05page1">Master schematic sheet with battery connector, charging circuit and power supply</a> to <a href="#schematic05page4">Schematic sheet including pushbutton switches, loco selection switches, direction switch, speed potentiometer and flashlight LEDs with controller</a>. It has been created with kicad and is available on the <a href="#github">[Github repository for wiFred]</a> along with the PCB design.</p>
</div>
<div id="schematic05page1" class="imageblock">
<div class="content">
<img src="images/wfred_rev2.png" alt="&quot;Schematic sheet 1 for rev0.5">
</div>
<div class="title">Figure 18. Master schematic sheet with battery connector, charging circuit and power supply</div>
</div>
<div id="schematic05page2" class="imageblock">
<div class="content">
<img src="images/wfred-wifi-Wifi_connection.png" alt="&quot;Schematic sheet 2 for rev0.5">
</div>
<div class="title">Figure 19. Schematic sheet including ESP8266 for WiFi connection with bootloader enabling jumper and connection to programming cable</div>
</div>
<div id="schematic05page3" class="imageblock">
<div class="content">
<img src="images/wfred-controller_rev2-Controller.png" alt="&quot;Schematic sheet 3 for rev0.5">
</div>
<div class="title">Figure 20. Schematic sheet including ATMega 328P along with crystal and in system programming header</div>
</div>
<div id="schematic05page4" class="imageblock">
<div class="content">
<img src="images/User_interface_rev2-User_Interface.png" alt="&quot;Schematic sheet 4 for rev0.5">
</div>
<div class="title">Figure 21. Schematic sheet including pushbutton switches, loco selection switches, direction switch, speed potentiometer and flashlight LEDs with controller</div>
</div>
</div>
<div class="sect2">
<h3 id="hintsFor05">Hints for building revisions up to 0.5</h3>
<div class="paragraph">
<p>The PCB has holes in the center of the LED footprints to enable transferring their positions to a StrapuBox housing with a sharp needle or to drill pilot holes with a 1 mm drill. For all other holes, there is a drill jig available which also allows the drilling of pilot holes for the pushbutton switches, the direction control switch and the speed potentiometer. <a href="#drilljigPicture">Using the original PCB and drilling jig to transfer the positions of the holes to the housing - better results will be achieved when the PCBs are screwed in position</a> shows the process and its results. Holes for the pushbutton switches should be drilled at 3.5 mm diameter. Holes for the LEDs should be drilled at 3 mm diameter and holes for the speed potentiometer at 8 mm, for the direction switch at 6.5 mm diameter. The cutouts for the loco selection switches are best drilled at 1.5 mm and extended to fit when the PCB is assembled with a jigsaw or a sharp hobby knife and a file.</p>
</div>
<table id="BOM05" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. List of components for the wiFred PCB up to revision 0.5</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Designator</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Designation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C102, C101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4u7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C105, C103, C302</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C206, C205</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22p</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C401, C203, C202, C201, C207</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C402, C301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C403</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CON101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB_Micro-B_Molex-105017-0001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USB-MICRO-B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED - red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT-23_Handsoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BAR43</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOP - red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D302</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORWARD - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D303</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REVERSE - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D303, D302, D301, D101, D102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED Spacer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D5.0mm_Horicontal_FLIPPED_O1.27mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED white</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D5.0mm_Horicontal_O1.27mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED white</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT95P270X145-5N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MCP73831T-2ACI_OT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT95P275X110-5N</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NCV8161BSN300T1G</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TQFP-32_7x7mm_Pitch0.8mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATMEGA328P-A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SOT-23-6_Handsoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MIC2860-2PYD6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_1x03_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART_ESP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K402</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_1x03_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART_AVR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">124mm x 35mm x 1.6mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Angled_1x02_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BATT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_2x03_Pitch2.54mm_SMD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_1x02_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP_BOOTLOAD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R101, R102</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">680R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2k2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4k7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R304, R303, R302, R204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">220R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15k</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R405, R404, R403, R201, R104</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10k</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P160KNPD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10k lin P160KNPD-4FC20B10K</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW302</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW303</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW307</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW308</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW309</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW311</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHIFT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW312</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESTOP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW313</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100SP1T1B1M1QEH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIRECTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW314</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW315</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW316</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW_SPST_PTS645</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12E_SMD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crystal_SMD_TXC_7M-4pin_3.2x2.5mm_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.7456MHz</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The remaining assembly is a basic exercise in installing all the components to the PCB, listed in <a href="#BOM05">List of components for the wiFred PCB up to revision 0.5</a>. From assembling the prototypes, the suggested order of installing the components is as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IC101, IC102, IC201 (note: Rotate PCB so Designator is right side up, then Pin 1 is on top left) and IC301</p>
</li>
<li>
<p>X201 and D201</p>
</li>
<li>
<p>USB connector CON101</p>
</li>
<li>
<p>Capacitors and Resistors in 0805 size (first those on the same side as the items before)</p>
</li>
<li>
<p>U401</p>
</li>
<li>
<p>Capacitors and Resistors not installed before - that is R403, R404, R405, C401, C402 and C403</p>
</li>
<li>
<p>Pushbutton switches SW305 to SW312 and SW314 to SW316 - taking care to place the red one at SW312 and the yellow one at SW311</p>
</li>
<li>
<p>Pin headers K401, K402 and P401 (correct alignment of K401 and K402 can be assured by adding a jumper before soldering)</p>
</li>
<li>
<p>Pin headers P101 and P201</p>
</li>
<li>
<p>Loco selection switches SW301 to SW304</p>
</li>
<li>
<p>LEDs D101, D102 and D301 to D303 with 3mm spacers to the PCB - making sure the Anode (long pin) is aligned with the square pad on all of them</p>
</li>
<li>
<p>LEDs D304 and D305 - making sure the Anode (long pin) is aligned with the square pad on both, they can be installed on top or bottom of the PCB as desired</p>
</li>
<li>
<p>Direction switch SW313 (screwed into the PCB with an 8 mm hex nut first, then attached to it&#8217;s pads using the cutoffs from D301, D302 and D303) and Speed potentiometer RV301 (screwed into the PCB with a 10 mm hex nut first)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To form a complete BOM, also include the parts listed in <a href="#BOM05extra">List of components for the wiFred up to revision 0.5 excluding electronic parts to solder to PCB</a> which are not soldered to the PCB but used in assembly later on.</p>
</div>
<table id="BOM05extra" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. List of components for the wiFred up to revision 0.5 excluding electronic parts to solder to PCB</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 50%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Designator</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Designation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Battery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lithium battery 1700mAh</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">H1a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Housing black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strapubox 2090</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or H1b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Housing white</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strapubox 2090</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">J1, J2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumper</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K1a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Potentiometer Knob silver</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">or K1b</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Potentiometer Knob black</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PCB</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">124mm x 35mm x 1.6mm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">S1, S2, S3, S4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mounting Screws</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2,9mm x 6,5mm</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After assembling the PCB with all the components, the holes and cutouts in the enclosure most likely will have to be reworked / extended to actually fit the PCB, then the PCB can be screwed into the enclosure with four screws. Afterwards the battery should be connected to P101 making sure the orientation is correct as shown in <a href="#battConnection">Connection of battery to P101 on revision 0.4 - black wire is GND, red wire is positive</a> and printed on the PCB, then the battery should be glued to the bottom of the enclosure with double-sided tape so it does not collide with any parts on the PCB, particularly P101 and SW313. Finally, both the ATMega 328P and the ESP8266 will need to be programmed with firmware as described in <a href="#flashing05">Writing the firmware to revision 0.5 and older wiFreds</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="flashing05">Writing the firmware to revision 0.5 and older wiFreds</h3>
<div class="sect3">
<h4 id="_avr_firmware">AVR firmware</h4>
<div class="paragraph">
<p>The ATMega 328P is programmed using the regular AVR ISP connection on P201. Pin 1 - GND - is towards the PCB edge, as shown in <a href="#progAVR">Programming connection for ATMega_328P - Pin 1 on purple cable</a>. An ISP dongle with either automatic voltage selection or 3.3 V supply voltage should be used to avoid placing too high voltage on the ESP8266, which can only support 3.3 V power. The firmware for the ATMega 328P can be found in the <strong>software/avr-firmware</strong>-subdirectory of the <a href="#github">[Github repository for wiFred]</a> with both a precompiled hexfile and all source code including a Makefile to recompile as needed. After writing the firmware file and the eeprom file, also the fuse bits need to be set properly as detailed in the <strong>main.c</strong>-file.</p>
</div>
<div id="progAVR" class="imageblock">
<div class="content">
<img src="images/DSC0146.jpg" alt="AVR programming">
</div>
<div class="title">Figure 22. Programming connection for ATMega_328P - Pin 1 on purple cable</div>
</div>
</div>
<div class="sect3">
<h4 id="_esp8266_firmware">ESP8266 firmware</h4>
<div class="paragraph">
<p>The ESP8266 is programmed using the Arduino IDE connected via a serial or USB-to-serial port to the K401 header as shown in <a href="#progESP8266">Programming connection for ESP8266 - GND on orange wire, then TXD of programming cable (RXD of ESP8266), then RXD of programming cable (TXD of ESP8266) - also note the jumper on P401</a>. The serial port needs to be at 3.3 V-levels like from an FTDI232-device run at 3.3 V. To program the ESP8266, first the ATMega 328P has to be programmed, a battery has to be connected and reasonably charged and one of the loco selection switches needs to be moved to the "enabled" position to power up the ESP8266.</p>
</div>
<div id="progESP8266" class="imageblock">
<div class="content">
<img src="images/DSC0138.jpg" alt="ESP8266 programming">
</div>
<div class="title">Figure 23. Programming connection for ESP8266 - GND on orange wire, then TXD of programming cable (RXD of ESP8266), then RXD of programming cable (TXD of ESP8266) - also note the jumper on P401</div>
</div>
<div class="paragraph">
<p>All files in the <strong>software/esp-firmware</strong>-subdirectory of the <a href="#github">[Github repository for wiFred]</a> need to be placed in a folder, then the main sketch <strong>arduino_main_sketch.ino.ino</strong> needs to be opened with the Arduino IDE. Settings for the Arduino IDE can be found inside the main file, programming the device should work using the <strong>Upload</strong>-button in the <strong>Sketch</strong>-menu.</p>
</div>
<div class="paragraph">
<p>To put the ESP8266 into programming mode, a jumper needs to be placed across the P401 header before powering up the ESP8266 by enabling one of the loco selection switches to start the device in programming mode. The red STOP LED should start flashing and the bootloader should show some results on the serial port and during download the LED on the ESP8266 module should flash as well.</p>
</div>
<div class="paragraph">
<p>After programming, two jumpers need to be placed between the K401 and K402 pin headers to re-enable communication between the ESP8266 and the ATMega 328P as shown in <a href="#serialJumpers">Communication jumpers for connecting the ESP8266 and the ATMega 328P</a>.</p>
</div>
<div id="serialJumpers" class="imageblock">
<div class="content">
<img src="images/DSC0149.jpg" alt="Serial communication jumpers">
</div>
<div class="title">Figure 24. Communication jumpers for connecting the ESP8266 and the ATMega 328P</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="oldThrottle">AA battery first prototype</h3>
<div class="paragraph">
<p>The wiFred prototype hardware is centered around an ESP8266 for the WiFi connection. The ESP8266 also reads the loco selection switches and the battery voltage and communicates through it&#8217;s serial port with an ATMega 328P microcontroller which controls the LEDs, reads the speed potentiometer, direction switch and pushbutton switches for functions and emergency stop. The communication goes through a 2x3 pin header which enables the user to connect a programming cable to the same serial port if removing the jumpers.</p>
</div>
<div class="paragraph">
<p>The wiFred prototype is powered by two AA size battery cells connected to a step-up converter creating 3.3 V for the entire device. As soon as a pair of batteries is inserted into the battery compartment as the symbols inside the battery compartment show, the throttle will boot up and try to connect to a wireless network. The throttle will not be damaged if batteries are inserted wrongly, but it will not work either. Use NiMH- or primary AA cells with 1.2 V to 1.5 V nominal voltage, low self discharge NiMH cells like Eneloop or similar are recommended.</p>
</div>
<div class="paragraph">
<p>The schematic is split into several pages and can be found in <a href="#oldSchematicPage1">Master schematic sheet with batteries and power supply</a> to <a href="#oldSchematicPage4">Schematic sheet including pushbutton switches, loco selection switches, direction switch and speed potentiometer</a>. It has been created with kicad and is available on the <a href="#github">[Github repository for wiFred]</a> along with the PCB design.</p>
</div>
<div id="oldSchematicPage1" class="imageblock">
<div class="content">
<img src="images/old_wfred_rev2.png" alt="Schematic page 1 for AA battery prototype">
</div>
<div class="title">Figure 25. Master schematic sheet with batteries and power supply</div>
</div>
<div id="oldSchematicPage2" class="imageblock">
<div class="content">
<img src="images/old_wfred-wifi-Wifi_connection.png" alt="Schematic page 2 for AA battery prototype">
</div>
<div class="title">Figure 26. Schematic sheet including ESP8266 for WiFi connection with bootloader enabling jumper and connection to programming cable</div>
</div>
<div id="oldSchematicPage3" class="imageblock">
<div class="content">
<img src="images/old_wfred-controller_rev2-Controller.png" alt="Schematic page 3 for AA battery prototype">
</div>
<div class="title">Figure 27. Schematic sheet including ATMega 328P along with crystal and in system programming header</div>
</div>
<div id="oldSchematicPage4" class="imageblock">
<div class="content">
<img src="images/old_User_interface_rev2-User_Interface.png" alt="Schematic page 4 for AA battery prototype">
</div>
<div class="title">Figure 28. Schematic sheet including pushbutton switches, loco selection switches, direction switch and speed potentiometer</div>
</div>
</div>
<div class="sect2">
<h3 id="_hints_for_building_the_wifred_aa_battery_prototype">Hints for building the wiFred AA battery prototype</h3>
<div class="paragraph">
<p>The prototype PCB has holes in the center of the pushbutton switch footprints and LED footprints to enable transferring their positions to a StrapuBox housing with a sharp needle or similar, and the position of the loco selection switches can also be transferred to the housing by marking it through the non-copper holes at their ends. Refer to <a href="#hintsFor05">Hints for building revisions up to 0.5</a> for pictures and more detail, the differences between the AA battery prototype and the LiPo battery revisions are minimal in this aspect.</p>
</div>
<div class="paragraph">
<p>The remaining assembly is a basic exercise in installing all the components to the PCB, listed in <a href="#oldWiFredBOM">List of components for the AA battery prototype wiFred</a>.</p>
</div>
<table id="oldWiFredBOM" class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 8. List of components for the AA battery prototype wiFred</caption>
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Designator</th>
<th class="tableblock halign-left valign-top">Package</th>
<th class="tableblock halign-left valign-top">Designation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">B101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KEYSTONE1013</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BATT_HOLDER</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C206, C205</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22p</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C301, C105, C104, C102, C101, C402</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C401, C204, C203, C202, C201, C103</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">STOP - red</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D302</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORWARD - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">D303</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LED_D3.0mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">REVERSE - green</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IC201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TQFP-32_7x7mm_Pitch0.8mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ATMEGA328P-A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_1x03_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART_ESP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K402</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_1x03_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART_AVR</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">L101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L_2424_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_2x03_Pitch2.54mm_SMD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ISP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">P401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pin_Header_Straight_1x02_Pitch2.54mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP_BOOTLOAD</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4k7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R304, R303, R302</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">470R</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100k</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R402</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47k</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">R405, R404, R403, R201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C_0805_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10k</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RV301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">P160KNPD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10k lin P160KNPD-4FC20B10K</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW302</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW303</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OS102011MS2Q</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">LOCO4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW307</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW308</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW309</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHIFT2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW311</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SHIFT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW312</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">KSC621G</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESTOP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SW313</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">100SP1T1B1M1QEH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DIRECTION</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U101</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TSSOP-8_4.4x3mm_Pitch0.65mm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L6920D</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">U401</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12E_SMD</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ESP-12E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Crystal_SMD_TXC_7M-4pin_3.2x2.5mm_HandSoldering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.7456MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Housing StrapuBox 6090</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two Jumpers, 2.54mm</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Potentiometer Knob, 21 mm</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Three fastening screws, 2.9 mm dia x 6.5 mm</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>After assembling the PCB with all the components and drilling and cutting the holes and cutouts into the housing, there are few steps left. First, a few protrusions inside the housing need to be removed so the PCB fits properly. <a href="#breakProtrusions">Removing protrusions inside the housing so the PCB fits</a> shows how they can be removed easily, remains may be cut off with a hobby knife. Second, new PCB mounting pads need to be installed as shown in <a href="#mountingPads">New PCB mounting pads made from 3 mm thick Forex PVC</a>. For the prototype, Forex PVC foam was used, cut with a pair of scissors and glued to the housing with superglue, making sure not to be in the way of any components on the PCB, but any kind of easily worked upon material with a thickness of 3 mm can be used, as long as it will take self-driving screws (prototype uses 2.9 mm by 6.5 mm DIN 7981 screws). Third, the two shift keys need yellow paint on the top and the emergency stop key needs red paint - either any kind of paint or a paint marker like Edding 751 will do. Finally, both the ESP8266 and the ATMega 328P will need to be programmed as described in <a href="#flashing05">Writing the firmware to revision 0.5 and older wiFreds</a>.</p>
</div>
<div id="breakProtrusions" class="imageblock">
<div class="content">
<img src="images/DSC8654.jpg" alt="Remove protrusions">
</div>
<div class="title">Figure 29. Removing protrusions inside the housing so the PCB fits</div>
</div>
<div id="mountingPads" class="imageblock">
<div class="content">
<img src="images/DSC8658.jpg" alt="New mounting pads">
</div>
<div class="title">Figure 30. New PCB mounting pads made from 3 mm thick Forex PVC</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="background">Background for wiFred development</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As of the writing of this document, <a href="#JMRI">[JMRI]</a> has a long track record of offering a server for using smartphones as wireless model railroad throttles, along with apps like <a href="#wiThrottleApp">[wiThrottle]</a><sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnotedef_10" title="View footnote.">10</a>]</sup> and <a href="#EngineDriver">[EngineDriver]</a>. This server will enable WiFi throttles to control locos any model railroading layout to which JMRI can build a connection <a href="#jmrihardwaresupport">[Supported Hardware]</a>. In addition, <a href="#Digitrax">[Digitrax LNWI]</a> and <a href="#MRC">[MRC Prodigy WiFi]</a> offer specific hardware solutions to enable the connection of the abovementioned smartphone apps to their DCC systems through a WiFi network.</p>
</div>
<div class="paragraph">
<p>The <a href="#Fremo">[Fremo]</a> is a European modular model railroading club whose unique requirements on its DCC throttles led to the creation of the throttles <a href="#FRED">[FRED]</a> and <a href="#FREDI">[FREDI]</a> - a series of LocoNet-throttles which started their life as hobbyist projects with large numbers in circulation but were also commercially available from <a href="#Uhlenbrock">[Uhlenbrock]</a>.</p>
</div>
<div class="sect2">
<h3 id="_specification_wishlist">Specification wishlist</h3>
<div class="paragraph">
<p>In modular railroading events, particularly of the Fremo-americaN-group, multiple people have evaluated the smartphone throttle solutions and found them lacking a nice, haptical feedback. But the idea of wireless control without locking into a specific vendor and their necessarily expensive equipment found great approval. So a wishlist was compiled to define the requirements for a wireless throttle:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Same form factor as the <a href="#FRED">[FRED]</a> with similar controls</p>
</li>
<li>
<p>Option to control at least two, better four locomotives for double/triple traction (similar to the double FRED)</p>
</li>
<li>
<p>Battery runtime of at least six hours</p>
</li>
<li>
<p>Exchangeable batteries, so when the battery runs down, they can be quickly exchanged for a charged set or cheap primary cells</p>
</li>
<li>
<p>Easy configuration, but not too easy to prevent operators from accidentally selecting other locomotives</p>
</li>
<li>
<p>As little change to the existing Fremo Loconet network as possible</p>
</li>
<li>
<p>Use of wiThrottle protocol, so the server side of the communication can be assumed to work and does not have to be developed as well</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_development_history">Development history</h3>
<div class="paragraph">
<p>The first prototype versions of the wiFred were built to run from two AA cells, either dry batteries or rechargeable NiMH cells. As described in <a href="#oldThrottle">AA battery first prototype</a> this required some special adaptations of the housing to fit all components. Even then, experience with the prototypes showed the battery compartment cover did not really fit and easily broke when trying to open and close the battery compartment.</p>
</div>
<div class="paragraph">
<p>So the next versions were built around an integrated lithium battery, losing the ability to exchange empty batteries, but with increased runtime and proper fit into the housing. Recharging of the second generation is done through a Micro USB connector, so a powerbank can extend the runtime of the device when the internal battery is exhausted. Also, the loco selection switches act as more of a power switch than they did with the first prototypes, reducing power consumption to a negligible amount when all locos are deselected.</p>
</div>
<div class="paragraph">
<p>The latest prototype will switch from a double processor implementation to a single, new ESP32-S2 processor, saving space, reducing the number of components, placing all SMD components on one side of the PCB and enabling direct USB firmware download. It will not contain any new features over the earlier LiPo battery versions, but mainly be easier to build for the hobbyist.</p>
</div>
</div>
<div class="sect2">
<h3 id="_wireless_clock">Wireless clock</h3>
<div class="paragraph">
<p>During the development of this wiFred another topic came up in the americaN group of the Fremo, namely wireless clocks with adjustable clock rate for Timetable &amp; Trainorder operations. This led to the spinoff of the <a href="#wiClock">[wiClock]</a> project.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a id="github"></a>[Github repository for wiFred] newHeiko/wiFred: wiThrottle-compatible hardware controller, <a href="https://github.com/newHeiko/wiFred" class="bare">https://github.com/newHeiko/wiFred</a></p>
</li>
<li>
<p><a id="JMRI"></a>[JMRI] JMRI: A Java Model Railroad Interface, <a href="https://www.jmri.org" class="bare">https://www.jmri.org</a></p>
</li>
<li>
<p><a id="jmrihardwaresupport"></a>[Supported Hardware] JMRI: Hardware Support, <a href="https://www.jmri.org/help/en/html/hardware/index.shtml" class="bare">https://www.jmri.org/help/en/html/hardware/index.shtml</a></p>
</li>
<li>
<p><a id="wiThrottleApp"></a>[wiThrottle] WiThrottle, <a href="https://www.withrottle.com/html/home.html" class="bare">https://www.withrottle.com/html/home.html</a></p>
</li>
<li>
<p><a id="EngineDriver"></a>[EngineDriver] Home | EngineDriver, <a href="https://enginedriver.mstevetodd.com/" class="bare">https://enginedriver.mstevetodd.com/</a></p>
</li>
<li>
<p><a id="Fremo"></a>[Fremo] Home - FREMO - Freundeskreis Europäischer Modelleisenbahner e.V., <a href="https://www.fremo-net.eu/en/home/" class="bare">https://www.fremo-net.eu/en/home/</a></p>
</li>
<li>
<p><a id="FRED"></a>[FRED] FRED, <a href="http://fremodcc.sourceforge.net/diy/fred/fred_e.html" class="bare">http://fremodcc.sourceforge.net/diy/fred/fred_e.html</a></p>
</li>
<li>
<p><a id="FREDI"></a>[FREDI] FREDI, <a href="http://fremodcc.sourceforge.net/diy/fred2/fredi_d.html" class="bare">http://fremodcc.sourceforge.net/diy/fred2/fredi_d.html</a> (German only)</p>
</li>
<li>
<p><a id="Uhlenbrock"></a>[Uhlenbrock] Uhlenbrock | FRED, der Handregler für die Intellibox, <a href="https://uhlenbrock.de/de_DE/produkte/prodarch/I62AD172-001.htm!ArcEntryInfo=0004.41.I62AD172" class="bare">https://uhlenbrock.de/de_DE/produkte/prodarch/I62AD172-001.htm!ArcEntryInfo=0004.41.I62AD172</a></p>
</li>
<li>
<p><a id="Digitrax"></a>[Digitrax LNWI] LocoNet WiFi interface, <a href="https://www.digitrax.com/products/wireless/lnwi/" class="bare">https://www.digitrax.com/products/wireless/lnwi/</a></p>
</li>
<li>
<p><a id="MRC"></a>[MRC Prodigy WiFi] Prodigy WiFi, <a href="https://www.modelrectifier.com/Prodigy-WiFi-s/332.htm" class="bare">https://www.modelrectifier.com/Prodigy-WiFi-s/332.htm</a></p>
</li>
<li>
<p><a id="rpiImage"></a>[Steve Todd] JMRI RaspberryPi as Access Point | M Steve Todd, <a href="https://mstevetodd.com/rpi" class="bare">https://mstevetodd.com/rpi</a></p>
</li>
<li>
<p><a id="wiClock"></a>[wiClock] wiClock, a WiFi-JMRI-Clock, found at <a href="https://github.com/newHeiko/WiFi-JMRI-Clock" class="bare">https://github.com/newHeiko/WiFi-JMRI-Clock</a> or its documentation at <a href="https://newHeiko.github.io/WiFi-JMRI-Clock" class="bare">https://newHeiko.github.io/WiFi-JMRI-Clock</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Only available on versions from 0.6 onwards with an ESP32-S2 MCU
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Pre-Shared Key, often just called password
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. In particular, long addresses 0-127 are not supported on many systems, for example those based on loconet.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. Momentary functions are only activated for as long as the function key is pressed - like a whistle or horn that sounds just as long as the key is pressed.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. Locking functions are toggled with every press of the function key - like pressing F0 once typically turns the headlight on, pressing F0 again turns it off.
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. The JMRI setting "F2 always momentary" will override this.
</div>
<div class="footnote" id="_footnotedef_7">
<a href="#_footnoteref_7">7</a>. This will also turn momentary functions permanently on.
</div>
<div class="footnote" id="_footnotedef_8">
<a href="#_footnoteref_8">8</a>. This is compatible to the Fredi&#8217;s "coasting" function
</div>
<div class="footnote" id="_footnotedef_9">
<a href="#_footnoteref_9">9</a>. It is suggested to configure the function to momentary as described in <a href="#throttle_FunctionConf">DCC function configuration</a> for this to work as intended
</div>
<div class="footnote" id="_footnotedef_10">
<a href="#_footnoteref_10">10</a>. wiThrottle is also the name JMRI uses for the protocol and the server.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 0.3<br>
Last updated 2025-03-26 21:21:34 +0100
</div>
</div>
</body>
</html>